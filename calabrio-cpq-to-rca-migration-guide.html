<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calabrio CPQ → RCA Product Migration Guide</title>
<style>
  :root {
    --bg: #0d1117;
    --surface: #161b22;
    --surface2: #1c2333;
    --border: #30363d;
    --text: #e6edf3;
    --text-muted: #8b949e;
    --accent: #58a6ff;
    --accent2: #3fb950;
    --warning: #d29922;
    --danger: #f85149;
    --code-bg: #0d1117;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.7;
    padding: 2rem;
    max-width: 1100px;
    margin: 0 auto;
  }
  h1 {
    font-size: 2rem;
    border-bottom: 2px solid var(--accent);
    padding-bottom: 0.5rem;
    margin-bottom: 0.5rem;
  }
  .subtitle {
    color: var(--text-muted);
    font-size: 1rem;
    margin-bottom: 2rem;
  }
  h2 {
    font-size: 1.5rem;
    color: var(--accent);
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    border-bottom: 1px solid var(--border);
    padding-bottom: 0.3rem;
  }
  h3 {
    font-size: 1.15rem;
    color: var(--accent2);
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
  }
  h4 { font-size: 1rem; color: var(--warning); margin-top: 1.2rem; margin-bottom: 0.4rem; }
  p { margin-bottom: 1rem; }
  a { color: var(--accent); text-decoration: none; }
  a:hover { text-decoration: underline; }
  code {
    background: var(--code-bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 0.15em 0.4em;
    font-family: 'Fira Code', 'Consolas', monospace;
    font-size: 0.9em;
    color: #f0883e;
  }
  pre {
    background: var(--code-bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1rem 1.2rem;
    overflow-x: auto;
    margin: 1rem 0;
    font-family: 'Fira Code', 'Consolas', monospace;
    font-size: 0.85rem;
    line-height: 1.6;
  }
  pre code { border: none; padding: 0; color: var(--text); }
  .callout {
    border-left: 4px solid var(--accent);
    background: var(--surface);
    padding: 1rem 1.2rem;
    margin: 1.2rem 0;
    border-radius: 0 6px 6px 0;
  }
  .callout.warn { border-color: var(--warning); }
  .callout.danger { border-color: var(--danger); }
  .callout.success { border-color: var(--accent2); }
  .callout-title { font-weight: 600; margin-bottom: 0.3rem; }
  .callout.warn .callout-title { color: var(--warning); }
  .callout.danger .callout-title { color: var(--danger); }
  .callout.success .callout-title { color: var(--accent2); }
  table {
    width: 100%;
    border-collapse: collapse;
    margin: 1rem 0;
    font-size: 0.9rem;
  }
  th, td {
    border: 1px solid var(--border);
    padding: 0.5rem 0.8rem;
    text-align: left;
  }
  th { background: var(--surface2); color: var(--accent); font-weight: 600; }
  tr:nth-child(even) { background: var(--surface); }
  .step-num {
    display: inline-block;
    width: 28px; height: 28px;
    background: var(--accent);
    color: var(--bg);
    border-radius: 50%;
    text-align: center;
    line-height: 28px;
    font-weight: 700;
    font-size: 0.85rem;
    margin-right: 0.5rem;
    flex-shrink: 0;
  }
  .step-header { display: flex; align-items: center; margin-bottom: 0.5rem; }
  .step-header h3 { margin: 0; }
  ul, ol { margin: 0.5rem 0 1rem 1.5rem; }
  li { margin-bottom: 0.3rem; }
  .toc { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 1.2rem 1.5rem; margin: 1.5rem 0; }
  .toc h3 { margin-top: 0; color: var(--text); }
  .toc ol { margin-bottom: 0; }
  .toc li { margin-bottom: 0.2rem; }
  .diagram { margin: 1.5rem 0; text-align: center; }
  .field-table code { font-size: 0.8rem; }
  .tag {
    display: inline-block;
    padding: 0.1em 0.5em;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
  }
  .tag-api { background: #1f3a5f; color: #58a6ff; }
  .tag-soql { background: #1a3a1a; color: #3fb950; }
  .tag-warn { background: #3d2e00; color: #d29922; }
  #back-to-top {
    position: fixed; bottom: 2rem; right: 2rem;
    width: 44px; height: 44px;
    background: var(--accent); color: var(--bg);
    border: none; border-radius: 50%; cursor: pointer;
    font-size: 1.4rem; display: none; z-index: 100;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    transition: opacity 0.3s;
  }
  #back-to-top:hover { opacity: 0.85; }
  #matrix-canvas {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    z-index: 9999; pointer-events: none; display: none;
  }
</style>
</head>
<body>

<canvas id="matrix-canvas"></canvas>

<h1>Calabrio CPQ to RCA Product Migration</h1>
<p class="subtitle">Technical Guide &mdash; Salesforce Revenue Cloud Advanced (RCA) &bull; Last updated: February 2026</p>

<div class="toc">
<h3>Contents</h3>
<ol>
  <li><a href="#overview">Overview &amp; Architecture</a></li>
  <li><a href="#object-model">Object Model Mapping (CPQ → RCA)</a></li>
  <li><a href="#prerequisites">Prerequisites</a></li>
  <li><a href="#step1">Step 1 — Extract Source Data from SIT</a></li>
  <li><a href="#step2">Step 2 — Query Target Org State</a></li>
  <li><a href="#step3">Step 3 — Gap Analysis</a></li>
  <li><a href="#step4">Step 4 — Create Missing Products</a></li>
  <li><a href="#step5">Step 5 — Create Component Groups</a></li>
  <li><a href="#step6">Step 6 — Create L1 Relationships (Bundle → Children)</a></li>
  <li><a href="#step7">Step 7 — Create L2 Relationships (Sub-bundles → Burst Fees)</a></li>
  <li><a href="#step8">Step 8 — Verification</a></li>
  <li><a href="#gotchas">Critical Gotchas &amp; Lessons Learned</a></li>
  <li><a href="#automation">Automation Script Reference</a></li>
  <li><a href="#bundles">Bundle Inventory</a></li>
</ol>
</div>

<!-- ───────────────────── OVERVIEW ───────────────────── -->
<h2 id="overview">1. Overview &amp; Architecture</h2>

<p>This guide covers migrating Calabrio's product catalog from <strong>Salesforce CPQ (SBQQ)</strong> in the SIT sandbox to <strong>Revenue Cloud Advanced (RCA)</strong> in the RCADev org. The CPQ model uses <code>SBQQ__ProductOption__c</code> for bundle hierarchies, while RCA uses native Salesforce objects.</p>

<p>The migration is <strong>structure-only</strong> &mdash; we replicate the bundle hierarchy (which products belong to which bundles, in which groups), not pricing rules, configuration rules, or enterprise product master records.</p>

<div class="diagram" id="diagram-overview"></div>

<h3>What Gets Migrated</h3>
<table>
  <tr><th>Layer</th><th>Description</th><th>Example</th></tr>
  <tr><td>Parent Bundle</td><td>Top-level product package (PK-*)</td><td>PK-WFM (Workforce Management)</td></tr>
  <tr><td>L1 Children</td><td>Software, services, and custom services within a bundle</td><td>SW-CWFM-STND, PS-IMPL, TR-TRAINING</td></tr>
  <tr><td>L2 Children</td><td>Burst fees, billing options nested under L1 products</td><td>BF-CWFM → under SW-CWFM-STND</td></tr>
  <tr><td>Component Groups</td><td>Feature groupings within a bundle</td><td>"Software", "Services", "Custom Services"</td></tr>
</table>

<!-- ───────────────────── OBJECT MODEL ───────────────────── -->
<h2 id="object-model">2. Object Model Mapping (CPQ → RCA)</h2>

<div class="diagram" id="diagram-mapping"></div>

<table>
  <tr><th>CPQ Object</th><th>RCA Object</th><th>Notes</th></tr>
  <tr><td><code>Product2</code></td><td><code>Product2</code></td><td>Same object. RCA adds <code>Type</code> picklist (Bundle/Set/Base).</td></tr>
  <tr><td><code>SBQQ__ProductOption__c</code></td><td><code>ProductRelatedComponent</code></td><td>Bundle → child relationship. One record per link.</td></tr>
  <tr><td><code>SBQQ__ProductFeature__c</code></td><td><code>ProductComponentGroup</code></td><td>Groups children within a bundle (e.g., "Software").</td></tr>
  <tr><td><code>PricebookEntry</code></td><td><code>PricebookEntry</code></td><td>Same object. $0 entries for bundle parents.</td></tr>
  <tr><td>N/A</td><td><code>ProductRelationshipType</code></td><td>RCA-specific. Defines the type of link (e.g., "Bundle to Bundle Component").</td></tr>
  <tr><td><code>SBQQ__ConsumptionSchedule__c</code></td><td><code>ConsumptionSchedule</code></td><td>Burst fee tiered pricing. Separate migration step.</td></tr>
</table>

<h3>Key Field Mapping — ProductRelatedComponent</h3>
<table class="field-table">
  <tr><th>Field (API Name)</th><th>Type</th><th>Required</th><th>Description</th></tr>
  <tr><td><code>ParentProductId</code></td><td>Reference</td><td>Yes</td><td>The bundle product</td></tr>
  <tr><td><code>ChildProductId</code></td><td>Reference</td><td>Yes*</td><td>The child product. <span class="tag tag-warn">NOT AssociatedProductId</span></td></tr>
  <tr><td><code>ProductRelationshipTypeId</code></td><td>Reference</td><td>Yes</td><td>Link to ProductRelationshipType</td></tr>
  <tr><td><code>ProductComponentGroupId</code></td><td>Reference</td><td>No</td><td>Optional grouping</td></tr>
  <tr><td><code>DoesBundlePriceIncludeChild</code></td><td>Boolean</td><td>Yes</td><td>Typically <code>false</code></td></tr>
  <tr><td><code>IsComponentRequired</code></td><td>Boolean</td><td>Yes</td><td>Typically <code>false</code></td></tr>
  <tr><td><code>IsQuantityEditable</code></td><td>Boolean</td><td>Yes</td><td>Must be <code>false</code> for Static bundles</td></tr>
  <tr><td><code>IsDefaultComponent</code></td><td>Boolean</td><td>Yes</td><td>Typically <code>true</code></td></tr>
</table>

<div class="callout warn">
  <div class="callout-title">Field Name Warning</div>
  <code>AssociatedProductId</code> works in SOQL relationship queries but is <strong>NOT</strong> the correct field for inserts. The DML/API create field is <code>ChildProductId</code>. Using the wrong name causes silent failures in bulk operations and explicit errors in REST calls.
</div>

<!-- ───────────────────── PREREQUISITES ───────────────────── -->
<h2 id="prerequisites">3. Prerequisites</h2>
<ul>
  <li><strong>sf CLI v2</strong> authenticated to both source (SIT) and target (RCADev) orgs</li>
  <li><strong>Python 3.8+</strong> with standard library (no pip packages required)</li>
  <li>Admin-level access in both orgs (Product2, PricebookEntry, ProductRelatedComponent CRUD)</li>
  <li>The <code>ProductRelationshipType</code> record "Bundle to Bundle Component Relationship" must exist in the target org</li>
</ul>

<pre><code># Verify org connections
sf org list | grep -E "SIT|RCADev"

# Check relationship types exist
sf data query -o RCADev -q "SELECT Id, Name FROM ProductRelationshipType"</code></pre>

<!-- ───────────────────── STEP 1 ───────────────────── -->
<h2 id="step1">4. Step 1 — Extract Source Data from SIT</h2>

<div class="step-header"><span class="step-num">1</span><h3>Query all ProductOptions from SIT</h3></div>

<p>Pull the complete CPQ bundle hierarchy. This captures every parent→child relationship across all bundles.</p>

<pre><code>sf data query -o SIT \
  -q "SELECT Id,
        SBQQ__ConfiguredSKU__r.ProductCode,
        SBQQ__ConfiguredSKU__r.Name,
        SBQQ__OptionalSKU__r.ProductCode,
        SBQQ__OptionalSKU__r.Name,
        SBQQ__Feature__r.Name,
        SBQQ__Type__c
      FROM SBQQ__ProductOption__c
      ORDER BY SBQQ__ConfiguredSKU__r.ProductCode" \
  --json > sit-product-options.json</code></pre>

<p>This returns ~1,051 records across ~100 parent products. The key fields:</p>
<ul>
  <li><code>SBQQ__ConfiguredSKU__r.ProductCode</code> → Parent bundle code</li>
  <li><code>SBQQ__OptionalSKU__r.ProductCode</code> → Child product code</li>
  <li><code>SBQQ__Feature__r.Name</code> → Maps to ComponentGroup name ("Software", "Services", etc.)</li>
</ul>

<!-- ───────────────────── STEP 2 ───────────────────── -->
<h2 id="step2">5. Step 2 — Query Target Org State</h2>

<div class="step-header"><span class="step-num">2</span><h3>Pull current RCADev inventory</h3></div>

<p>Query three objects to understand what already exists:</p>

<pre><code># Products
sf data query -o RCADev \
  -q "SELECT Id, ProductCode, Name, Family, Type, IsActive
      FROM Product2 ORDER BY ProductCode" --json

# Component Groups
sf data query -o RCADev \
  -q "SELECT Id, Name, ParentProductId, ParentProduct.ProductCode
      FROM ProductComponentGroup
      ORDER BY ParentProduct.ProductCode, Name" --json

# Existing Relationships
sf data query -o RCADev \
  -q "SELECT Id, ParentProduct.ProductCode, ChildProduct.ProductCode,
             ProductComponentGroup.Name
      FROM ProductRelatedComponent
      ORDER BY ParentProduct.ProductCode" --json</code></pre>

<p>Build lookup dictionaries:</p>
<ul>
  <li><code>prod_by_code</code>: ProductCode → Product2 record (with Id)</li>
  <li><code>group_lookup</code>: (ParentProductCode, GroupName) → GroupId</li>
  <li><code>existing_rels</code>: Set of (ParentCode, ChildCode) tuples</li>
</ul>

<!-- ───────────────────── STEP 3 ───────────────────── -->
<h2 id="step3">6. Step 3 — Gap Analysis</h2>

<div class="step-header"><span class="step-num">3</span><h3>Compare SIT hierarchy vs RCADev state</h3></div>

<p>For each bundle being migrated, identify:</p>

<table>
  <tr><th>Check</th><th>Action if Missing</th></tr>
  <tr><td>Parent bundle product exists?</td><td>Create Product2 with <code>Type='Bundle'</code></td></tr>
  <tr><td>Each L1 child product exists?</td><td>Create Product2 (set Type appropriately)</td></tr>
  <tr><td>Each L2 child product exists?</td><td>Create Product2 (burst fees typically have no Type)</td></tr>
  <tr><td>PricebookEntries for new products?</td><td>Create $0 Standard PBE for each new product</td></tr>
  <tr><td>Component groups on parent?</td><td>Create ProductComponentGroup</td></tr>
  <tr><td>Component groups on L2 sub-bundles?</td><td>Create "Burst Fees" or "Billing" group</td></tr>
  <tr><td>L1 relationships exist?</td><td>Create ProductRelatedComponent</td></tr>
  <tr><td>L2 relationships exist?</td><td>Create ProductRelatedComponent</td></tr>
</table>

<!-- ───────────────────── STEP 4 ───────────────────── -->
<h2 id="step4">7. Step 4 — Create Missing Products</h2>

<div class="step-header"><span class="step-num">4</span><h3>Create Product2 records</h3></div>

<pre><code># Via sf CLI
sf data create record -o RCADev -s Product2 \
  -v "ProductCode='SW-BOTANA' Name='Bot Analytics' Type='Bundle' Family='Analytics' IsActive=true"

# Via REST API (preferred for programmatic use)
curl -X POST "$INSTANCE_URL/services/data/v62.0/sobjects/Product2" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "ProductCode": "SW-BOTANA",
    "Name": "Bot Analytics",
    "Type": "Bundle",
    "Family": "Analytics",
    "IsActive": true
  }'</code></pre>

<div class="callout danger">
  <div class="callout-title">Product2.Type is IMMUTABLE</div>
  <p>The <code>Type</code> field on Product2 is <strong>Createable but NOT Updateable</strong>. Once a product is created, you cannot change its Type through any means — API, Apex, Tooling API, or anonymous Apex. All attempts return <code>Field is not writeable: Product2.Type</code>.</p>
  <p><strong>If you create a product without <code>Type='Bundle'</code>, you must delete and recreate it.</strong> This means also deleting and recreating any PricebookEntries and ProductRelatedComponent records that reference it.</p>
</div>

<h4>Product Type Rules</h4>
<ul>
  <li><code>PK-*</code> (parent bundles) → <code>Type='Bundle'</code></li>
  <li><code>SW-*</code> (software products with burst fee children) → <code>Type='Bundle'</code></li>
  <li><code>PS-*</code> (service products with billing children) → <code>Type='Bundle'</code></li>
  <li><code>TR-*</code> (training products with billing children) → <code>Type='Bundle'</code></li>
  <li><code>BF-*</code> (burst fee leaf products) → <code>Type='Bundle'</code> or omit</li>
</ul>

<p>After creating each product, create a <strong>$0 Standard PricebookEntry</strong>:</p>
<pre><code>curl -X POST "$INSTANCE_URL/services/data/v62.0/sobjects/PricebookEntry" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "Product2Id": "&lt;new_product_id&gt;",
    "Pricebook2Id": "&lt;standard_pricebook_id&gt;",
    "UnitPrice": 0,
    "IsActive": true
  }'</code></pre>

<div class="callout">
  <div class="callout-title">Finding the Standard Pricebook ID</div>
  <pre><code>sf data query -o RCADev -q "SELECT Id FROM Pricebook2 WHERE IsStandard = true"</code></pre>
</div>

<!-- ───────────────────── STEP 5 ───────────────────── -->
<h2 id="step5">8. Step 5 — Create Component Groups</h2>

<div class="step-header"><span class="step-num">5</span><h3>Create ProductComponentGroup records</h3></div>

<p>Each bundle needs groups that organize its children. The CPQ <code>Feature</code> name maps directly to the RCA group name.</p>

<table>
  <tr><th>CPQ Feature Name</th><th>RCA Group Name</th><th>Used On</th></tr>
  <tr><td>Software</td><td>Software</td><td>PK-* parent bundles</td></tr>
  <tr><td>Services</td><td>Services</td><td>PK-* parent bundles</td></tr>
  <tr><td>Custom Services</td><td>Custom Services</td><td>PK-* parent bundles</td></tr>
  <tr><td>(burst fee children)</td><td>Burst Fees</td><td>SW-* sub-bundles</td></tr>
  <tr><td>(billing children)</td><td>Billing</td><td>PS-*/TR-* sub-bundles</td></tr>
  <tr><td>(mixed children)</td><td>Options</td><td>PS-IMPL and similar</td></tr>
</table>

<pre><code>curl -X POST "$INSTANCE_URL/services/data/v62.0/sobjects/ProductComponentGroup" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "Name": "Software",
    "ParentProductId": "&lt;bundle_product_id&gt;"
  }'</code></pre>

<div class="callout warn">
  <div class="callout-title">Parent Must Have Type Set</div>
  <p>Creating a ProductComponentGroup requires the parent product to have a non-null <code>Type</code> field. If Type is null, you'll get: <code>"Parent product type should not be null."</code></p>
</div>

<!-- ───────────────────── STEP 6 ───────────────────── -->
<h2 id="step6">9. Step 6 — Create L1 Relationships</h2>

<div class="step-header"><span class="step-num">6</span><h3>Link bundle parents to L1 children</h3></div>

<p>For each child in the SIT <code>ProductOption</code> where the parent is a <code>PK-*</code> bundle, create a <code>ProductRelatedComponent</code>.</p>

<pre><code>curl -X POST "$INSTANCE_URL/services/data/v62.0/sobjects/ProductRelatedComponent" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "ParentProductId": "&lt;bundle_id&gt;",
    "ChildProductId": "&lt;child_product_id&gt;",
    "ProductRelationshipTypeId": "&lt;rel_type_id&gt;",
    "ProductComponentGroupId": "&lt;group_id&gt;",
    "DoesBundlePriceIncludeChild": false,
    "IsComponentRequired": false,
    "IsQuantityEditable": false,
    "IsDefaultComponent": true
  }'</code></pre>

<div class="callout danger">
  <div class="callout-title">Static Bundle Constraint</div>
  <p>Products with <code>Type='Bundle'</code> are treated as "Static" bundles. For their child relationships, <code>IsQuantityEditable</code> <strong>must be <code>false</code></strong>. Setting it to <code>true</code> returns: <code>"Quantity cannot be changed at runtime for a Static Parent Product."</code></p>
  <p>Use <code>IsQuantityEditable=false</code> as the safe default for all relationships.</p>
</div>

<!-- ───────────────────── STEP 7 ───────────────────── -->
<h2 id="step7">10. Step 7 — Create L2 Relationships</h2>

<div class="step-header"><span class="step-num">7</span><h3>Link sub-bundles to burst fees &amp; billing products</h3></div>

<p>L2 relationships are children-of-children. For example:</p>
<ul>
  <li><code>PK-WFM</code> → <code>SW-CWFM-STND</code> (L1) → <code>BF-CWFM</code> (L2 burst fee)</li>
  <li><code>PK-CQM</code> → <code>PS-IMPL</code> (L1) → <code>PS-PC-Billing</code> + <code>PS-UP-Billing</code> (L2 billing)</li>
</ul>

<p>The process is identical to Step 6 — create <code>ProductRelatedComponent</code> records. The parent is the L1 product, and the child is the burst fee or billing product.</p>

<p>Ensure each L2 parent has a component group first ("Burst Fees" for <code>SW-*</code> parents, "Billing" for <code>PS-*</code>/<code>TR-*</code> parents).</p>

<!-- ───────────────────── STEP 8 ───────────────────── -->
<h2 id="step8">11. Step 8 — Verification</h2>

<div class="step-header"><span class="step-num">8</span><h3>Validate the migration</h3></div>

<pre><code># Count total relationships
sf data query -o RCADev \
  -q "SELECT COUNT(Id) FROM ProductRelatedComponent"

# Check specific bundle
sf data query -o RCADev \
  -q "SELECT ChildProduct.ProductCode, ProductComponentGroup.Name
      FROM ProductRelatedComponent
      WHERE ParentProduct.ProductCode = 'PK-WFM'
      ORDER BY ProductComponentGroup.Name, ChildProduct.ProductCode"</code></pre>

<p>Compare the count and child codes against the SIT source data. Every <code>ProductOption</code> for the migrated bundle should have a corresponding <code>ProductRelatedComponent</code> in RCADev.</p>

<!-- ───────────────────── GOTCHAS ───────────────────── -->
<h2 id="gotchas">12. Critical Gotchas &amp; Lessons Learned</h2>

<div class="callout danger">
  <div class="callout-title">1. Product2.Type is Immutable</div>
  <p><code>Createable: true, Updateable: false</code>. Not changeable via API, Apex, or Tooling API. Delete and recreate if wrong. This cascade-deletes PBEs and relationships too.</p>
</div>

<div class="callout danger">
  <div class="callout-title">2. ChildProductId vs AssociatedProductId</div>
  <p>SOQL uses the relationship name <code>AssociatedProduct</code> in queries, but the DML insert field is <code>ChildProductId</code>. The Bulk API may silently accept the wrong field name while creating zero records.</p>
</div>

<div class="callout warn">
  <div class="callout-title">3. IsQuantityEditable Must Be false for Static Bundles</div>
  <p>Any product with <code>Type='Bundle'</code> is a Static bundle. Child relationships must have <code>IsQuantityEditable=false</code> or insertion fails.</p>
</div>

<div class="callout warn">
  <div class="callout-title">4. ComponentGroup Requires Parent Type</div>
  <p>You cannot create a <code>ProductComponentGroup</code> on a product with <code>Type=null</code>. Set the Type at product creation time.</p>
</div>

<div class="callout warn">
  <div class="callout-title">5. Bulk API Result Parsing is Unreliable</div>
  <p><code>sf data import bulk</code> may return <code>success=0, failed=0</code> even when records are created. Always verify with a follow-up SOQL count. For smaller batches (&lt;200), use REST API directly for reliable feedback.</p>
</div>

<div class="callout">
  <div class="callout-title">6. Standard Pricebook ID Varies by Org</div>
  <p>Always query <code>SELECT Id FROM Pricebook2 WHERE IsStandard = true</code> rather than hardcoding. The ID differs across orgs/sandboxes.</p>
</div>

<div class="callout">
  <div class="callout-title">7. ProductComponentGroupId is Optional</div>
  <p>Relationships can be created without a group. This is useful if the parent product can't have groups created on it (e.g., Type is null and can't be fixed).</p>
</div>

<!-- ───────────────────── AUTOMATION ───────────────────── -->
<h2 id="automation">13. Automation Script Reference</h2>

<p>A reusable Python script handles end-to-end migration for any bundle:</p>

<pre><code># List available bundles
python3 calabrio-bundle-migrate.py --list

# Dry run (shows what would be created, no changes)
python3 calabrio-bundle-migrate.py PK-BA PK-CR PK-ONE --dry-run

# Execute migration
python3 calabrio-bundle-migrate.py PK-BA PK-CR PK-ONE</code></pre>

<h3>What the Script Does</h3>
<ol>
  <li>Loads cached SIT ProductOption data from JSON</li>
  <li>Queries RCADev for current products, groups, and relationships</li>
  <li>Identifies gaps (missing products, groups, relationships)</li>
  <li>Creates missing Product2 records with correct <code>Type='Bundle'</code></li>
  <li>Creates $0 PricebookEntries for new products</li>
  <li>Creates ProductComponentGroups on parent bundles</li>
  <li>Creates L1 ProductRelatedComponent records (bundle → children)</li>
  <li>Creates L2 ProductRelatedComponent records (sub-bundles → burst fees/billing)</li>
  <li>Skips already-existing records (safe to re-run)</li>
</ol>

<h3>Script Dependencies</h3>
<ul>
  <li><code>sf</code> CLI authenticated to RCADev</li>
  <li><code>curl</code> (for REST API calls)</li>
  <li>Python 3.8+ (standard library only)</li>
  <li><code>/mnt/c/projects/sit-product-options-fresh.json</code> — cached SIT data</li>
</ul>

<!-- ───────────────────── BUNDLES ───────────────────── -->
<h2 id="bundles">14. Bundle Inventory</h2>

<table>
  <tr><th>Bundle</th><th>Name</th><th>L1 Children</th><th>L2 Relationships</th><th>Status</th></tr>
  <tr><td><code>PK-WFM</code></td><td>Workforce Management</td><td>35</td><td>~50</td><td style="color:var(--accent2)">Complete</td></tr>
  <tr><td><code>PK-CQM</code></td><td>Quality Management</td><td>57</td><td>~85</td><td style="color:var(--accent2)">Complete</td></tr>
  <tr><td><code>PK-BA</code></td><td>Bot Analytics</td><td>7</td><td>7</td><td style="color:var(--warning)">Ready</td></tr>
  <tr><td><code>PK-CR</code></td><td>Call Recording</td><td>9</td><td>12</td><td style="color:var(--warning)">Ready</td></tr>
  <tr><td><code>PK-ONE</code></td><td>Calabrio ONE</td><td>42</td><td>45</td><td style="color:var(--warning)">Ready</td></tr>
  <tr><td><code>LEGACY-WR</code></td><td>Legacy SKU Wrapper</td><td>737</td><td>N/A</td><td style="color:var(--text-muted)">Not migrating</td></tr>
</table>

<h3>PK-BA — New Products Needed</h3>
<p>2 products: <code>SW-BOTANA</code> (Bot Analytics), <code>BF-BOTANA</code> (burst fee)</p>

<h3>PK-CR — New Products Needed</h3>
<p>2 products: <code>SW-CQMCR</code> (Call Recording), <code>BF-CQMCR</code> (burst fee)</p>

<h3>PK-ONE — New Products Needed</h3>
<p>26 products total:</p>
<ul>
  <li><strong>15 L1:</strong> SW-CALONE, SW-CALONE-ENT, SW-CALONE-ENT400/800/1600, SW-CALONE-ENT-10K, SW-CALONE-ENTPLUS-10K, SW-CALONE-ESS-10K, SW-ONEARX, SW-ONELAB, PS-ADDLACD, PS-CALONE-ENT-IMPL, PS-CALONE-ENTUPG-IMPL, PS-ONESRV-UPGRD, TR-CALONE-ENT-TRAINING</li>
  <li><strong>11 L2 burst fees:</strong> BF-CALONE, BF-CALONE-ENT, BF-CALONE-ENT400/800/1600, BF-CALONE-ENT-USER, BF-CALONE-ENT-INT, BF-CALONE-ENTPLUS-USER, BF-CALONE-ENTPLUS-INT, BF-CALONE-ESS-USER, BF-CALONE-ESS-INT</li>
</ul>

<button id="back-to-top" onclick="window.scrollTo({top:0,behavior:'smooth'})">&uarr;</button>

<script>
// ── Back to Top Button ──
window.addEventListener('scroll', () => {
  document.getElementById('back-to-top').style.display = window.scrollY > 400 ? 'block' : 'none';
});

// ── SVG Diagram: Overview ──
(function() {
  const container = document.getElementById('diagram-overview');
  const w = 900, h = 320;
  const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
  svg.setAttribute('width', w);
  svg.setAttribute('height', h);
  svg.setAttribute('viewBox', `0 0 ${w} ${h}`);
  svg.style.maxWidth = '100%';

  const boxes = [
    { x: 350, y: 10,  w: 200, h: 44, text: 'PK-WFM (Bundle)', color: '#58a6ff', level: 'L0' },
    { x: 30,  y: 100, w: 180, h: 40, text: 'Custom Services (4)', color: '#d29922', level: 'L1' },
    { x: 240, y: 100, w: 160, h: 40, text: 'Services (10)', color: '#d29922', level: 'L1' },
    { x: 430, y: 100, w: 180, h: 40, text: 'Software (21)', color: '#d29922', level: 'L1' },
    { x: 640, y: 100, w: 220, h: 40, text: 'Component Groups', color: '#30363d', level: 'label' },
    { x: 50,  y: 180, w: 160, h: 36, text: 'PS-CUSTSVCS-STND', color: '#3fb950', level: 'L1p' },
    { x: 250, y: 180, w: 160, h: 36, text: 'PS-IMPL', color: '#3fb950', level: 'L1p' },
    { x: 450, y: 180, w: 175, h: 36, text: 'SW-CWFM-STND', color: '#3fb950', level: 'L1p' },
    { x: 665, y: 180, w: 175, h: 36, text: 'SW-CWFMVAP', color: '#3fb950', level: 'L1p' },
    { x: 55,  y: 260, w: 150, h: 34, text: 'PS-PC-Billing', color: '#f85149', level: 'L2' },
    { x: 255, y: 260, w: 150, h: 34, text: 'PS-UP-Billing', color: '#f85149', level: 'L2' },
    { x: 460, y: 260, w: 155, h: 34, text: 'BF-CWFM', color: '#f85149', level: 'L2' },
    { x: 670, y: 260, w: 165, h: 34, text: 'BF-CWFVAP', color: '#f85149', level: 'L2' },
  ];

  const connections = [
    [0, 1], [0, 2], [0, 3],
    [1, 5], [2, 6], [3, 7], [3, 8],
    [5, 9], [6, 10], [7, 11], [8, 12]
  ];

  // Draw connections
  connections.forEach(([fi, ti]) => {
    const f = boxes[fi], t = boxes[ti];
    const x1 = f.x + f.w / 2, y1 = f.y + f.h;
    const x2 = t.x + t.w / 2, y2 = t.y;
    const mid = (y1 + y2) / 2;
    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    path.setAttribute('d', `M${x1},${y1} C${x1},${mid} ${x2},${mid} ${x2},${y2}`);
    path.setAttribute('stroke', '#30363d');
    path.setAttribute('stroke-width', '2');
    path.setAttribute('fill', 'none');
    path.setAttribute('marker-end', 'url(#arrow)');
    svg.appendChild(path);
  });

  // Arrow marker
  const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
  const marker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
  marker.setAttribute('id', 'arrow');
  marker.setAttribute('viewBox', '0 0 10 10');
  marker.setAttribute('refX', '10'); marker.setAttribute('refY', '5');
  marker.setAttribute('markerWidth', '8'); marker.setAttribute('markerHeight', '8');
  marker.setAttribute('orient', 'auto-start-reverse');
  const arrowPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
  arrowPath.setAttribute('d', 'M 0 0 L 10 5 L 0 10 z');
  arrowPath.setAttribute('fill', '#30363d');
  marker.appendChild(arrowPath);
  defs.appendChild(marker);
  svg.appendChild(defs);

  // Draw boxes
  boxes.forEach(b => {
    if (b.level === 'label') {
      const txt = document.createElementNS('http://www.w3.org/2000/svg', 'text');
      txt.setAttribute('x', b.x); txt.setAttribute('y', b.y + 25);
      txt.setAttribute('fill', '#8b949e'); txt.setAttribute('font-size', '12');
      txt.setAttribute('font-style', 'italic');
      txt.textContent = b.text;
      svg.appendChild(txt);
      return;
    }
    const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
    rect.setAttribute('x', b.x); rect.setAttribute('y', b.y);
    rect.setAttribute('width', b.w); rect.setAttribute('height', b.h);
    rect.setAttribute('rx', '6');
    rect.setAttribute('fill', '#161b22');
    rect.setAttribute('stroke', b.color);
    rect.setAttribute('stroke-width', b.level === 'L0' ? '2.5' : '1.5');
    svg.appendChild(rect);

    const txt = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    txt.setAttribute('x', b.x + b.w / 2); txt.setAttribute('y', b.y + b.h / 2 + 5);
    txt.setAttribute('text-anchor', 'middle');
    txt.setAttribute('fill', b.color);
    txt.setAttribute('font-size', b.level === 'L0' ? '14' : '12');
    txt.setAttribute('font-weight', b.level === 'L0' ? '700' : '500');
    txt.setAttribute('font-family', '-apple-system, sans-serif');
    txt.textContent = b.text;
    svg.appendChild(txt);
  });

  // Level labels
  const labels = [
    { y: 30, text: 'Parent Bundle', x: 5 },
    { y: 120, text: 'L1 Children', x: 5 },
    { y: 260, text: 'L2 (Burst Fees)', x: 5 },
  ];
  labels.forEach(l => {
    const t = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    t.setAttribute('x', l.x); t.setAttribute('y', l.y + 80);
    t.setAttribute('fill', '#484f58'); t.setAttribute('font-size', '10');
    t.setAttribute('font-family', '-apple-system, sans-serif');
    t.setAttribute('transform', `rotate(-90, ${l.x}, ${l.y + 80})`);
    t.textContent = l.text;
    svg.appendChild(t);
  });

  container.appendChild(svg);
})();

// ── SVG Diagram: Object Mapping ──
(function() {
  const container = document.getElementById('diagram-mapping');
  const w = 800, h = 200;
  const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
  svg.setAttribute('width', w);
  svg.setAttribute('height', h);
  svg.setAttribute('viewBox', `0 0 ${w} ${h}`);
  svg.style.maxWidth = '100%';

  const cpqBoxes = [
    { x: 20,  y: 30, w: 200, h: 36, text: 'SBQQ__ProductOption__c' },
    { x: 20,  y: 80, w: 200, h: 36, text: 'SBQQ__ProductFeature__c' },
    { x: 20,  y: 130, w: 200, h: 36, text: 'Product2' },
  ];
  const rcaBoxes = [
    { x: 500, y: 30, w: 260, h: 36, text: 'ProductRelatedComponent' },
    { x: 500, y: 80, w: 260, h: 36, text: 'ProductComponentGroup' },
    { x: 500, y: 130, w: 260, h: 36, text: 'Product2 (with Type field)' },
  ];

  // Labels
  const cpqLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
  cpqLabel.setAttribute('x', 120); cpqLabel.setAttribute('y', 18);
  cpqLabel.setAttribute('text-anchor', 'middle');
  cpqLabel.setAttribute('fill', '#f85149'); cpqLabel.setAttribute('font-size', '13');
  cpqLabel.setAttribute('font-weight', '700');
  cpqLabel.textContent = 'CPQ (Source)';
  svg.appendChild(cpqLabel);

  const rcaLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
  rcaLabel.setAttribute('x', 630); rcaLabel.setAttribute('y', 18);
  rcaLabel.setAttribute('text-anchor', 'middle');
  rcaLabel.setAttribute('fill', '#3fb950'); rcaLabel.setAttribute('font-size', '13');
  rcaLabel.setAttribute('font-weight', '700');
  rcaLabel.textContent = 'RCA (Target)';
  svg.appendChild(rcaLabel);

  function drawBox(b, color) {
    const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
    rect.setAttribute('x', b.x); rect.setAttribute('y', b.y);
    rect.setAttribute('width', b.w); rect.setAttribute('height', b.h);
    rect.setAttribute('rx', '5');
    rect.setAttribute('fill', '#161b22'); rect.setAttribute('stroke', color);
    rect.setAttribute('stroke-width', '1.5');
    svg.appendChild(rect);
    const txt = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    txt.setAttribute('x', b.x + b.w / 2); txt.setAttribute('y', b.y + b.h / 2 + 5);
    txt.setAttribute('text-anchor', 'middle');
    txt.setAttribute('fill', '#e6edf3'); txt.setAttribute('font-size', '12');
    txt.setAttribute('font-family', "'Fira Code', monospace");
    txt.textContent = b.text;
    svg.appendChild(txt);
  }

  cpqBoxes.forEach(b => drawBox(b, '#f85149'));
  rcaBoxes.forEach(b => drawBox(b, '#3fb950'));

  // Arrows
  for (let i = 0; i < 3; i++) {
    const y = cpqBoxes[i].y + cpqBoxes[i].h / 2;
    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    line.setAttribute('x1', cpqBoxes[i].x + cpqBoxes[i].w);
    line.setAttribute('y1', y);
    line.setAttribute('x2', rcaBoxes[i].x);
    line.setAttribute('y2', y);
    line.setAttribute('stroke', '#58a6ff');
    line.setAttribute('stroke-width', '2');
    line.setAttribute('stroke-dasharray', '6,4');
    svg.appendChild(line);

    // Arrow head
    const tri = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
    const ax = rcaBoxes[i].x - 2;
    tri.setAttribute('points', `${ax},${y} ${ax - 10},${y - 5} ${ax - 10},${y + 5}`);
    tri.setAttribute('fill', '#58a6ff');
    svg.appendChild(tri);
  }

  container.appendChild(svg);
})();

// ── Konami Code Matrix Rain Easter Egg ──
(function() {
  const code = [38,38,40,40,37,39,37,39,66,65];
  let pos = 0;
  document.addEventListener('keydown', function(e) {
    if (e.keyCode === code[pos]) {
      pos++;
      if (pos === code.length) {
        pos = 0;
        toggleMatrix();
      }
    } else {
      pos = 0;
    }
  });

  let matrixActive = false;
  let matrixInterval = null;

  function toggleMatrix() {
    const canvas = document.getElementById('matrix-canvas');
    if (matrixActive) {
      matrixActive = false;
      clearInterval(matrixInterval);
      canvas.style.display = 'none';
      return;
    }
    matrixActive = true;
    canvas.style.display = 'block';
    canvas.style.pointerEvents = 'none';
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const fontSize = 14;
    const columns = Math.floor(canvas.width / fontSize);
    const drops = Array(columns).fill(1);
    const chars = 'アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヲン0123456789ABCDEF';

    matrixInterval = setInterval(function() {
      ctx.fillStyle = 'rgba(13,17,23,0.05)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#3fb950';
      ctx.font = fontSize + 'px monospace';
      for (let i = 0; i < drops.length; i++) {
        const text = chars[Math.floor(Math.random() * chars.length)];
        ctx.fillStyle = Math.random() > 0.98 ? '#fff' : '#3fb950';
        ctx.fillText(text, i * fontSize, drops[i] * fontSize);
        if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
          drops[i] = 0;
        }
        drops[i]++;
      }
    }, 40);

    setTimeout(function() {
      if (matrixActive) toggleMatrix();
    }, 15000);
  }
})();
</script>

</body>
</html>
